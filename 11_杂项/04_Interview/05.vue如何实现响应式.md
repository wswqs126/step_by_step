# vue 如何实现响应式

关键函数：`Object.defineProperty`

## 定义

- 修改 data，vue 立刻监听到，并更新 dom
- data 属性代理到 vm，即 data 中的属性变成的 vm 的属性，通过 `this` 可访问

## 创建对象的两种方法

- 字面量

```js
var obj = {
  name: 'xiaoguang',
  age: 25,
};

// 访问和设置都是静态的
console.log(obj.name);
obj.name = 'xiaohong';
```

- Object.defineProperty 实现监听

```js
var obj = {};
var _name = 'xiaoguang';

Object.defineProperty(obj, 'name', {
  get() {
    console.log('get name');
    return _name;
  }, // 不是分号

  set(newValue) {
    console.log('set name');
    _name = newValue;
  },
})

console.log(obj.name);
obj.name = 'xiaohong';
```

> 创建对象有几种方法？

## 模拟将 data 代理到 vm

```js
// vue 实例
// var vm = new Vue({
//   el: '#app',
//   data: {
//     name: 'xx',
//     age: 22,
//   },
// });

// 开始模拟
var vm = {};
var data = {
  name: 'xx',
  age: 22, 
};

for (key in data) {
  // 闭包，保证 key 的独立作用域
  (function(key) {
    Object.defineProperty(vm, key, {
      get() {
        console.log(`get value`);
        return data[key];
      },

      set(newValue) {
        console.log('set value');
        // vm[key] = newValue;
        data[key] = newValue; // 这里还是 data 的key
      },
    })
  })(key);
}
```



